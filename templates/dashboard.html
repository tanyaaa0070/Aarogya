<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - AarogyaAI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <img src="{{ url_for('static', filename='uploads/logo.jpeg') }}" alt="AarogyaAI logo" class="logo">
                <h2>AarogyaAI</h2>
            </div>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/record">Record Symptoms</a>
                <a href="/dashboard" class="active">Dashboard</a>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 2rem;">
        <h1>Admin Dashboard</h1>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ stats.total }}</div>
                <div class="stat-label">Total Cases</div>
            </div>
            <div class="stat-card critical">
                <div class="stat-number">{{ stats.critical }}</div>
                <div class="stat-label">游댮 Critical</div>
            </div>
            <div class="stat-card urgent">
                <div class="stat-number">{{ stats.urgent }}</div>
                <div class="stat-label">游리 Urgent</div>
            </div>
            <div class="stat-card stable">
                <div class="stat-number">{{ stats.stable }}</div>
                <div class="stat-label">游릭 Stable</div>
            </div>
        </div>

        <div class="chart-section">
            <h2>Case Distribution</h2>
            <div class="chart-container">
                <canvas id="triageChart"></canvas>
            </div>
        </div>

        <div class="filter-section">
            <h2>Patient Records</h2>
            <div class="filter-buttons">
                <a href="/dashboard?filter=ALL" class="filter-btn {% if filter == 'ALL' %}active{% endif %}">All</a>
                <a href="/dashboard?filter=RED" class="filter-btn {% if filter == 'RED' %}active{% endif %}">游댮 Critical</a>
                <a href="/dashboard?filter=YELLOW" class="filter-btn {% if filter == 'YELLOW' %}active{% endif %}">游리 Urgent</a>
                <a href="/dashboard?filter=GREEN" class="filter-btn {% if filter == 'GREEN' %}active{% endif %}">游릭 Stable</a>
            </div>
        </div>

        <div class="records-table">
            {% if records %}
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Patient Name</th>
                        <th>Age</th>
                        <th>Diagnosis</th>
                        <th>Triage</th>
                        <th>Confidence</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in records %}
                    <tr>
                        <td>#{{ record.id }}</td>
                        <td>{{ record.patient_name }}</td>
                        <td>{{ record.age }}</td>
                        <td>{{ record.ai_diagnosis }}</td>
                        <td><span class="triage-badge-small triage-{{ record.triage_level.lower() if record.triage_level }}">{{ record.triage_color }} {{ record.triage_level }}</span></td>
                        <td>{{ record.confidence }}%</td>
                        <td>{{ record.created_at[:16] if record.created_at else 'N/A' }}</td>
                        <td>
                            <button class="btn-small" onclick="viewRecord('{{ record.id }}')">View</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="no-records">
                <p>No records found{% if filter != 'ALL' %} for the '{{ filter }}' triage level{% endif %}.</p>
                {% if filter != 'ALL' %}
                <a href="/dashboard" class="btn btn-secondary" style="margin-top:1rem;">Show All Records</a>
                {% else %}
                <a href="/record" class="btn btn-primary" style="margin-top:1rem;">Record First Patient</a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 AarogyaAI. Empowering Healthcare Workers with AI Technology.</p>
        </div>
    </footer>

    <script>
        const stats = {{ stats | tojson | safe }};
        
        const ctx = document.getElementById('triageChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Critical', 'Urgent', 'Stable'],
                datasets: [{
                    data: [stats.critical, stats.urgent, stats.stable],
                    backgroundColor: ['#dc3545', '#ffc107', '#28a745'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    }
                }
            }
        });

        function viewRecord(id) {
            window.location.href = '/result?id=' + id;
        }
    </script>
</body>
</html>